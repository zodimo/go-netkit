# Story 1.1: Transport Core Interface Transformation

<!-- Powered by BMADâ„¢ Core -->

## Status
Draft

## Story
**As a** library developer,  
**I want** the core transport.go file to use cbio interfaces instead of standard I/O interfaces,  
**so that** the foundation layer provides callback-style asynchronous I/O operations with cancellation and configuration support.

## Acceptance Criteria

**AC1**: TransportHandler.OnOpen method signature changes from `func(conn io.WriteCloser)` to `func(conn cbio.WriteCloser)`

**AC2**: FromReaderWriterCloser function is refactored to FromReaderWriteCloser with signature `func(ctx context.Context, rwc cbio.ReadWriteCloser, options ...ConfigOption) TransportReceiver`

**AC3**: transportActor struct uses cbio.ReadWriteCloser instead of io.ReadWriteCloser for its rwc field

**AC4**: All write operations in transport layer use callback handlers with proper success/error handling

**AC5**: TransportReceiver return type changes to return cbio.Closer instead of io.Closer

## Tasks / Subtasks

- [ ] Update TransportHandler interface (AC: 1)
  - [ ] Change OnOpen method signature to accept cbio.WriteCloser
  - [ ] Update all interface documentation
  - [ ] Verify interface compatibility across codebase

- [ ] Refactor FromReaderWriterCloser function (AC: 2)
  - [ ] Rename to FromReaderWriteCloser
  - [ ] Update function signature to accept cbio.ReadWriteCloser
  - [ ] Add ConfigOption parameter support
  - [ ] Update function implementation for callback patterns

- [ ] Update transportActor struct (AC: 3)
  - [ ] Change rwc field type to cbio.ReadWriteCloser
  - [ ] Update struct initialization code
  - [ ] Modify all rwc field usage to callback patterns

- [ ] Convert write operations to callback handlers (AC: 4)
  - [ ] Identify all write operations in transport layer
  - [ ] Implement callback success handlers
  - [ ] Implement callback error handlers
  - [ ] Add proper error propagation

- [ ] Update TransportReceiver return type (AC: 5)
  - [ ] Change return type from io.Closer to cbio.Closer
  - [ ] Update all return statements
  - [ ] Verify caller compatibility

- [ ] Unit testing
  - [ ] Update transport_test.go to use cbio mocks
  - [ ] Test callback success scenarios
  - [ ] Test callback error scenarios
  - [ ] Test cancellation behavior
  - [ ] Verify all existing tests pass

## Dev Notes

### Previous Story Insights
This is the first story in the epic, so no previous story context is available.

### Architecture Context
The cbio package provides callback-style interfaces that replace standard Go I/O interfaces:
- `cbio.WriteCloser` replaces `io.WriteCloser` with callback-based write operations
- `cbio.ReadWriteCloser` replaces `io.ReadWriteCloser` with callback-based read/write operations
- `cbio.Closer` replaces `io.Closer` with callback-based close operations

### Technical Implementation Details
- All callback operations should provide both immediate error handling and operation completion callbacks
- Cancellation support must be implemented through the cbio.Canceler interface
- Configuration options should be passed through ConfigOption parameters
- Thread safety must be maintained across all callback operations

### File Locations
Primary files to modify:
- `transport.go` - Core transport interface and implementation
- `transport_test.go` - Unit tests for transport layer

### Testing Requirements
- All existing test cases must pass with new cbio interfaces
- New tests should verify callback behavior for success and error scenarios
- Cancellation behavior must be thoroughly tested
- Performance characteristics should be validated

### Testing
- Test file location: Same directory as source files with `_test.go` suffix
- Test standards: Use Go's built-in testing framework
- Testing frameworks: Standard Go testing with table-driven tests where appropriate
- Mock interfaces should implement cbio interfaces for testing callback behavior

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-01-XX | 1.0 | Initial story creation from epic | BMad Master |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*
